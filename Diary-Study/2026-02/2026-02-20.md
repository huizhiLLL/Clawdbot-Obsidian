# 2026-02-20 - SQL 表设计基础

## 📚 学习主题

**主题：** SQL 表设计基础
**类别：** SQL 基础
**难度：** 初级

---

## 🎯 核心知识点

### 1. 数据表的基本概念

数据表是数据库中存储数据的结构化形式，由行（记录）和列（字段）组成。

**表结构示例：**
```
users 表
┌──────────┬────────┬─────────┬─────────────┐
│ id       │ name   │ age     │ email       │
├──────────┼────────┼─────────┼─────────────┤
│ 1        │ 张三   │ 25      │ a@test.com  │
│ 2        │ 李四   │ 30      │ b@test.com  │
│ 3        │ 王五   │ 22      │ c@test.com  │
└──────────┴────────┴─────────┴─────────────┘
```

### 2. 常用数据类型

#### 字符串类型
| 类型 | 说明 | 示例 |
|------|------|------|
| `CHAR(n)` | 固定长度字符串，不足用空格填充 | `CHAR(10)` - 总是 10 字符 |
| `VARCHAR(n)` | 可变长度字符串，最多 n 个字符 | `VARCHAR(255)` - 最多 255 字符 |
| `TEXT` | 长文本，无长度限制 | 文章内容、描述等 |

#### 数值类型
| 类型 | 说明 | 范围 |
|------|------|------|
| `TINYINT` | 极小整数 | -128 到 127 |
| `SMALLINT` | 小整数 | -32,768 到 32,767 |
| `INT` / `INTEGER` | 标准整数 | -2^31 到 2^31-1 |
| `BIGINT` | 大整数 | -2^63 到 2^63-1 |
| `DECIMAL(m,d)` | 精确小数 | 如 `DECIMAL(10,2)` - 共10位，2位小数 |
| `FLOAT` | 单精度浮点数 | 近似值 |
| `DOUBLE` | 双精度浮点数 | 近似值，更精确 |

#### 日期时间类型
| 类型 | 说明 | 示例 |
|------|------|------|
| `DATE` | 日期（年-月-日） | `'2026-02-20'` |
| `TIME` | 时间（时:分:秒） | `'14:30:00'` |
| `DATETIME` | 日期和时间 | `'2026-02-20 14:30:00'` |
| `TIMESTAMP` | 时间戳 | `1708420200`（从 1970-01-01 起的秒数） |
| `YEAR` | 年份 | `2026` |

#### 其他类型
| 类型 | 说明 |
|------|------|
| `BOOLEAN` | 布尔值（TRUE/FALSE），部分数据库用 TINYINT(1) |
| `ENUM` | 枚举，从预定义值中选择一个 |
| `JSON` | JSON 格式数据（MySQL 5.7+、PostgreSQL 等） |

### 3. 主键（Primary Key）

主键是表中唯一标识每一行的列，具有以下特点：
- 值唯一，不能重复
- 不能为 NULL
- 一张表只能有一个主键
- 通常使用自增整数 ID

**示例：**
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50),
    email VARCHAR(100)
);
```

**复合主键（多列作为主键）：**
```sql
CREATE TABLE orders (
    order_id INT,
    user_id INT,
    order_date DATE,
    PRIMARY KEY (order_id, user_id)
);
```

### 4. 外键（Foreign Key）

外键用于建立表与表之间的关联关系，指向另一个表的主键。

**示例：用户和订单的关系**
```sql
-- 用户表
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE
);

-- 订单表
CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    total_amount DECIMAL(10, 2),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**外键的作用：**
- 保证数据一致性（不能插入不存在的 user_id）
- 防止误删（如果用户有订单，就不能直接删除用户）
- 维护表之间的关系

### 5. 约束条件

| 约束 | 说明 | 示例 |
|------|------|------|
| `NOT NULL` | 列不能为空 | `name VARCHAR(50) NOT NULL` |
| `UNIQUE` | 值必须唯一 | `email VARCHAR(100) UNIQUE` |
| `DEFAULT` | 默认值 | `status VARCHAR(20) DEFAULT 'active'` |
| `AUTO_INCREMENT` | 自增（MySQL） | `id INT PRIMARY KEY AUTO_INCREMENT` |
| `CHECK` | 自定义条件检查 | `age INT CHECK (age >= 18)` |

**完整示例：**
```sql
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    stock INT DEFAULT 0 CHECK (stock >= 0),
    status VARCHAR(20) DEFAULT 'available',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 6. 设计规范与最佳实践

#### 命名规范
- 表名：使用小写字母和下划线，使用复数形式（如 `users`, `orders`）
- 列名：小写字母和下划线，描述性命名（如 `user_id`, `created_at`）
- 主键：通常命名为 `id`，复合主键使用描述性名称

#### 数据类型选择建议
- **字符串：**
  - 固定长度的代码（如状态码、ISBN）→ CHAR
  - 变长文本（姓名、标题）→ VARCHAR
  - 长文本（文章内容）→ TEXT
- **数值：**
  - 整数优先使用 INT，除非确定范围
  - 金额、价格等精确数值 → DECIMAL
  - 科学计算 → DOUBLE/FLOAT
- **日期时间：**
  - 存储日期 → DATE
  - 存储时间 → TIME
  - 存储完整日期时间 → DATETIME 或 TIMESTAMP

#### 性能优化建议
- 为经常查询的列添加索引（WHERE、JOIN、ORDER BY）
- 避免使用 TEXT 类型作为主键或外键
- 合理设置 VARCHAR 长度，避免浪费空间
- 使用适当的数据类型，不要都用 VARCHAR 或 TEXT

#### 数据完整性
- 为主键选择稳定的、不变化的列（如自增 ID）
- 合理使用外键保证关联数据的一致性
- 使用 NOT NULL 避免空值带来的歧义
- 使用 UNIQUE 约束保证业务唯一性（如用户名、邮箱）

---

## 🔗 知识关联

- **与 CRUD 的关系：** 设计好表结构后，才能进行 INSERT、SELECT、UPDATE、DELETE 操作
- **与 WHERE 的关系：** 表设计中定义的列名用于 WHERE 子句的条件查询
- **与 JOIN 的关系：** 外键设计决定了表之间如何关联查询
- **后续学习：** 学完表设计后，可以深入学习 JOIN（多表查询）和索引优化

---

## 📝 练习

### 练习 1：创建用户表
创建一个用户表，包含以下字段：
- id（主键，自增）
- username（用户名，不能为空，唯一）
- email（邮箱，唯一）
- age（年龄，必须 >= 18）
- created_at（创建时间，默认为当前时间）

```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) UNIQUE,
    age INT CHECK (age >= 18),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 练习 2：创建文章表
创建一个文章表，包含以下字段：
- id（主键，自增）
- title（标题，不能为空，最多 200 字符）
- content（内容，长文本）
- author_id（作者 ID，外键关联 users 表的 id）
- view_count（浏览次数，默认 0）
- created_at（创建时间）

```sql
CREATE TABLE articles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    author_id INT,
    view_count INT DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (author_id) REFERENCES users(id)
);
```

### 练习 3：设计电商商品表
创建一个商品表，要求：
- 包含 id、name、price、category、stock、status 字段
- price 必须大于 0
- stock 不能为负数
- status 默认为 'available'
- category 和 status 不能为空

```sql
CREATE TABLE products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    category VARCHAR(50) NOT NULL,
    stock INT DEFAULT 0 CHECK (stock >= 0),
    status VARCHAR(20) NOT NULL DEFAULT 'available',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 练习 4：设计订单表
创建一个订单表，包含：
- id（主键，自增）
- user_id（用户 ID，外键）
- total_amount（订单总额，精确到 2 位小数）
- status（订单状态：pending, paid, shipped, completed, cancelled）
- created_at（下单时间）
- shipped_at（发货时间，可以为空）

```sql
CREATE TABLE orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    total_amount DECIMAL(10, 2) NOT NULL CHECK (total_amount > 0),
    status VARCHAR(20) NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'paid', 'shipped', 'completed', 'cancelled')),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    shipped_at DATETIME,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

## 📚 延伸阅读

### 设计原则
1. **第三范式（3NF）：** 避免数据冗余，每个非主键列都直接依赖于主键
2. **适度规范化：** 不要过度规范化，平衡查询性能和数据一致性
3. **考虑查询需求：** 根据实际的查询场景设计表结构，适当添加冗余字段提升性能

### 常见错误
1. **过度使用 VARCHAR：** 对于固定长度数据，应该使用 CHAR
2. **金额使用 FLOAT：** 金额等精确数值必须使用 DECIMAL
3. **缺少约束：** 该设 NOT NULL 的没设，该 UNIQUE 的没设
4. **外键缺失：** 关联表没有设置外键，导致数据不一致

### 推荐练习
- 根据实际需求设计几个表（博客系统、电商系统、学生管理系统）
- 练习添加各种约束和默认值
- 学习如何修改表结构（ALTER TABLE）

---

**📅 学习日期：** 2026-02-20
**⏰ 预计学习时间：** 60 分钟

---

## 🧠 测验问题

请回答以下问题，检验你的学习成果：

### 问题 1
在设计数据库表时，应该使用哪种数据类型来存储商品价格（需要精确计算）？

A. `FLOAT`
B. `DOUBLE`
C. `DECIMAL`
D. `VARCHAR`

### 问题 2
关于外键（Foreign Key）的描述，哪项是正确的？

A. 外键用于保证当前表的主键值唯一
B. 外键指向另一个表的主键，用于建立表之间的关联关系
C. 外键必须设置为 NOT NULL
D. 一张表只能有一个外键

### 问题 3
主键（Primary Key）的以下特点中，哪项是错误的？

A. 值必须唯一，不能重复
B. 不能为 NULL
C. 一张表只能有一个主键
D. 主键的值可以随意修改

---

**请将你的答案发送给我，我会帮你检查！** 📝
