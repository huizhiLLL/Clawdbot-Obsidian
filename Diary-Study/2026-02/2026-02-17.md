# 2026-02-17 - å­¦ä¹ ç¬”è®°

## ğŸ“š ä»Šæ—¥ä¸»é¢˜ï¼šNode.js HTTP æœåŠ¡å™¨

**åˆ†ç±»ï¼š** Node.js åŸºç¡€  
**éš¾åº¦ï¼š** Beginner  
**ä¼˜å…ˆçº§ï¼š** 14

---

## ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹

### 1. åˆ›å»º HTTP æœåŠ¡å™¨

Node.js å†…ç½®çš„ `http` æ¨¡å—æä¾›äº†åˆ›å»º HTTP æœåŠ¡å™¨çš„åŠŸèƒ½ã€‚

```javascript
const http = require('http');

// åˆ›å»ºæœåŠ¡å™¨
const server = http.createServer((req, res) => {
  // req: è¯·æ±‚å¯¹è±¡ï¼ˆIncomingMessageï¼‰
  // res: å“åº”å¯¹è±¡ï¼ˆServerResponseï¼‰
});

// ç›‘å¬ç«¯å£
server.listen(3000, () => {
  console.log('Server running at http://localhost:3000');
});
```

### 2. è¯·æ±‚å¯¹è±¡ï¼ˆreqï¼‰

å¸¸ç”¨å±æ€§å’Œæ–¹æ³•ï¼š

```javascript
// è·å–è¯·æ±‚æ–¹æ³•å’Œ URL
req.method      // 'GET', 'POST', 'PUT', 'DELETE' ç­‰
req.url         // è¯·æ±‚çš„è·¯å¾„ï¼Œå¦‚ '/users'
req.headers     // è¯·æ±‚å¤´å¯¹è±¡

// è·å–è¯·æ±‚ä½“ï¼ˆPOST/PUTï¼‰
let body = '';
req.on('data', chunk => {
  body += chunk.toString();
});
req.on('end', () => {
  // body åŒ…å«å®Œæ•´è¯·æ±‚ä½“
});
```

### 3. å“åº”å¯¹è±¡ï¼ˆresï¼‰

å¸¸ç”¨æ–¹æ³•ï¼š

```javascript
// è®¾ç½®çŠ¶æ€ç 
res.statusCode = 200;  // æˆ–ä½¿ç”¨ res.writeHead(200)

// è®¾ç½®å“åº”å¤´
res.setHeader('Content-Type', 'application/json');
// æˆ– res.writeHead(200, { 'Content-Type': 'application/json' });

// å‘é€å“åº”æ•°æ®
res.write('Hello');  // å¯ä»¥å¤šæ¬¡è°ƒç”¨
res.end();           // ç»“æŸå“åº”
// æˆ– res.end('Hello World');  // ä¸€æ¬¡æ€§å‘é€å¹¶ç»“æŸ

// å‘é€ JSON æ•°æ®
res.end(JSON.stringify({ message: 'Success' }));
```

### 4. è·¯ç”±å¤„ç†

é€šè¿‡ `req.method` å’Œ `req.url` å®ç°ç®€å•çš„è·¯ç”±ï¼š

```javascript
const server = http.createServer((req, res) => {
  if (req.url === '/' && req.method === 'GET') {
    res.end('Home Page');
  } else if (req.url === '/api/users' && req.method === 'GET') {
    res.setHeader('Content-Type', 'application/json');
    res.end(JSON.stringify({ users: [] }));
  } else if (req.url === '/api/users' && req.method === 'POST') {
    let body = '';
    req.on('data', chunk => body += chunk);
    req.on('end', () => {
      const user = JSON.parse(body);
      res.end(JSON.stringify({ message: 'User created', user }));
    });
  } else {
    res.statusCode = 404;
    res.end('Not Found');
  }
});
```

### 5. çŠ¶æ€ç 

å¸¸è§ HTTP çŠ¶æ€ç ï¼š

- **200 OK** - è¯·æ±‚æˆåŠŸ
- **201 Created** - èµ„æºåˆ›å»ºæˆåŠŸ
- **400 Bad Request** - è¯·æ±‚æ ¼å¼é”™è¯¯
- **404 Not Found** - èµ„æºä¸å­˜åœ¨
- **500 Internal Server Error** - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

---

## ğŸ”— çŸ¥è¯†å…³è”

- **Node.js æ¨¡å—ç³»ç»Ÿ**ï¼šä½¿ç”¨ `require` å¯¼å…¥ `http` æ¨¡å—
- **å¼‚æ­¥ç¼–ç¨‹**ï¼šHTTP è¯·æ±‚å¤„ç†æ˜¯å¼‚æ­¥çš„ï¼Œä½¿ç”¨å›è°ƒå‡½æ•°
- **JSON æ•°æ®æ ¼å¼**ï¼šAPI å¸¸ç”¨ JSON è¿›è¡Œæ•°æ®äº¤æ¢
- **HTTP åè®®**ï¼šç†è§£è¯·æ±‚æ–¹æ³•ã€çŠ¶æ€ç ã€è¯·æ±‚å¤´/å“åº”å¤´

---

## ğŸ’» ç»ƒä¹ ä»»åŠ¡

### ä»»åŠ¡ 1ï¼šåˆ›å»ºé™æ€æ–‡ä»¶æœåŠ¡å™¨
```javascript
// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œè¿”å›é™æ€ HTML é¡µé¢
const http = require('http');
const fs = require('fs');

const server = http.createServer((req, res) => {
  if (req.url === '/') {
    fs.readFile('./index.html', (err, data) => {
      if (err) {
        res.statusCode = 500;
        res.end('Error loading file');
      } else {
        res.setHeader('Content-Type', 'text/html');
        res.end(data);
      }
    });
  } else {
    res.statusCode = 404;
    res.end('Not Found');
  }
});

server.listen(3000);
```

### ä»»åŠ¡ 2ï¼šå®ç°ç®€å• REST API
åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ”¯æŒä»¥ä¸‹ç«¯ç‚¹ï¼š
- `GET /api/todos` - è¿”å›æ‰€æœ‰å¾…åŠäº‹é¡¹
- `POST /api/todos` - åˆ›å»ºæ–°å¾…åŠäº‹é¡¹
- `DELETE /api/todos/:id` - åˆ é™¤æŒ‡å®šå¾…åŠäº‹é¡¹

```javascript
let todos = [];
let nextId = 1;

const server = http.createServer((req, res) => {
  const url = req.url;
  const method = req.method;

  // å¤„ç† GET /api/todos
  if (url === '/api/todos' && method === 'GET') {
    res.setHeader('Content-Type', 'application/json');
    res.end(JSON.stringify(todos));
  }

  // å¤„ç† POST /api/todos
  else if (url === '/api/todos' && method === 'POST') {
    let body = '';
    req.on('data', chunk => body += chunk);
    req.on('end', () => {
      const todo = JSON.parse(body);
      const newTodo = { id: nextId++, ...todo, completed: false };
      todos.push(newTodo);
      res.statusCode = 201;
      res.end(JSON.stringify(newTodo));
    });
  }

  // å¤„ç† DELETE /api/todos/:id
  else if (url.startsWith('/api/todos/') && method === 'DELETE') {
    const id = parseInt(url.split('/')[3]);
    const index = todos.findIndex(t => t.id === id);
    if (index !== -1) {
      todos.splice(index, 1);
      res.end(JSON.stringify({ message: 'Deleted' }));
    } else {
      res.statusCode = 404;
      res.end('Not Found');
    }
  }

  else {
    res.statusCode = 404;
    res.end('Not Found');
  }
});
```

### ä»»åŠ¡ 3ï¼šæ·»åŠ  CORS æ”¯æŒ
```javascript
// è®¾ç½®å“åº”å¤´å…è®¸è·¨åŸŸè¯·æ±‚
res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods', 'GET, POST, DELETE');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
```

---

## ğŸ“– å»¶ä¼¸é˜…è¯»

- [Node.js HTTP æ–‡æ¡£](https://nodejs.org/api/http.html)
- [MDN - HTTP æ¦‚è¿°](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview)
- [RESTful API è®¾è®¡æŒ‡å—](https://restfulapi.net/)
- [Express.js æ¡†æ¶](https://expressjs.com/) - æ›´å¼ºå¤§çš„ Node.js Web æ¡†æ¶

---

## ğŸ’¡ å­¦ä¹ æç¤º

1. ä½¿ç”¨ `curl` æˆ– Postman æµ‹è¯•ä½ çš„ API
2. åœ¨å¼€å‘æ—¶æ·»åŠ  `console.log` è°ƒè¯•è¯·æ±‚ä¿¡æ¯
3. ç”Ÿäº§ç¯å¢ƒè€ƒè™‘ä½¿ç”¨ Express æˆ– Koa ç­‰æ¡†æ¶
4. æ³¨æ„å¤„ç†é”™è¯¯æƒ…å†µï¼ˆ400ã€404ã€500ï¼‰

---

## ğŸ“ æµ‹éªŒé—®é¢˜

**è¯·å›ç­”ä»¥ä¸‹é—®é¢˜ï¼Œæ£€éªŒå­¦ä¹ æˆæœï¼š**

1. **åŸºç¡€é¢˜**ï¼š`req` å’Œ `res` å¯¹è±¡åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ`req.url` å’Œ `req.method` åˆ†åˆ«è¿”å›ä»€ä¹ˆå†…å®¹ï¼Ÿ

2. **åº”ç”¨é¢˜**ï¼šå¦‚ä½•è®¾ç½®å“åº”çš„çŠ¶æ€ç ä¸º 404ï¼Œå¹¶è¿”å› JSON æ ¼å¼çš„é”™è¯¯ä¿¡æ¯ `{ "error": "Not Found" }`ï¼Ÿ

3. **è¿›é˜¶é¢˜**ï¼šåœ¨å¤„ç† POST è¯·æ±‚æ—¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦é€šè¿‡ `req.on('data', ...)` å’Œ `req.on('end', ...)` æ¥è·å–è¯·æ±‚ä½“ï¼Ÿè¿™ä¸ªè¿‡ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

---

**å®Œæˆæ—¶é—´ï¼š** 2026-02-17  
**çŠ¶æ€ï¼š** å­¦ä¹ ä¸­
