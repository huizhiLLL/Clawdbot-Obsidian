# 2026-02-14 å­¦ä¹ è®°å½•

**ä¸»é¢˜ï¼š** Node.js æ¨¡å—ç³»ç»Ÿ

**åˆ†ç±»ï¼š** Node.js åŸºç¡€

**éš¾åº¦ï¼š** beginner

---

## ğŸ“Œ æ ¸å¿ƒçŸ¥è¯†ç‚¹

### 1. CommonJS è§„èŒƒ

Node.js é»˜è®¤ä½¿ç”¨ CommonJS æ¨¡å—ç³»ç»Ÿï¼Œä¸»è¦é€šè¿‡ `require()` å’Œ `module.exports` æ¥å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—ã€‚

#### å¯¼å…¥æ¨¡å—
```javascript
// å¯¼å…¥å†…ç½®æ¨¡å—
const fs = require('fs');
const path = require('path');

// å¯¼å…¥ç¬¬ä¸‰æ–¹æ¨¡å—
const express = require('express');

// å¯¼å…¥æœ¬åœ°æ¨¡å—ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
const utils = require('./utils');
const myModule = require('./myModule/index');
```

#### å¯¼å‡ºæ¨¡å—
```javascript
// æ–¹å¼ 1ï¼šå¯¼å‡ºå•ä¸ªå€¼
module.exports = function() {
  console.log('Hello!');
};

// æ–¹å¼ 2ï¼šå¯¼å‡ºå¯¹è±¡
module.exports = {
  name: 'MyModule',
  sayHello() {
    console.log('Hello!');
  }
};

// æ–¹å¼ 3ï¼šä½¿ç”¨ exportsï¼ˆæ³¨æ„ï¼šä¸èƒ½ç›´æ¥èµ‹å€¼ exportsï¼‰
exports.name = 'MyModule';
exports.sayHello = function() {
  console.log('Hello!');
};
```

### 2. ES Module (ESM)

Node.js ä¹Ÿæ”¯æŒ ES6 æ¨¡å—è¯­æ³•ï¼Œé€šè¿‡ `.mjs` æ‰©å±•åæˆ–åœ¨ `package.json` ä¸­è®¾ç½® `"type": "module"` æ¥å¯ç”¨ã€‚

#### å¯¼å…¥æ¨¡å—
```javascript
// å¯¼å…¥å†…ç½®æ¨¡å—ï¼ˆéœ€æ·»åŠ  node: å‰ç¼€ï¼‰
import fs from 'node:fs';
import path from 'node:path';

// å¯¼å…¥ç¬¬ä¸‰æ–¹æ¨¡å—
import express from 'express';

// å¯¼å…¥æœ¬åœ°æ¨¡å—
import utils from './utils.js';
import { sayHello } from './myModule.js';
```

#### å¯¼å‡ºæ¨¡å—
```javascript
// é»˜è®¤å¯¼å‡º
export default function() {
  console.log('Hello!');
}

// å‘½åå¯¼å‡º
export const name = 'MyModule';
export function sayHello() {
  console.log('Hello!');
}

// æ··åˆå¯¼å‡º
const util1 = () => {};
const util2 = () => {};
export { util1, util2 };
export default { util1, util2 };
```

### 3. æ¨¡å—åŠ è½½æœºåˆ¶

```javascript
// Node.js æ¨¡å—æŸ¥æ‰¾é¡ºåºï¼š
// 1. å†…ç½®æ¨¡å—ï¼ˆå¦‚ fsã€pathï¼‰
// 2. ç›¸å¯¹è·¯å¾„æ¨¡å—ï¼ˆ./ æˆ– ../ å¼€å¤´ï¼‰
// 3. ç»å¯¹è·¯å¾„æ¨¡å—ï¼ˆ/ å¼€å¤´ï¼‰
// 4. node_modules ä¸­çš„æ¨¡å—

// require() ä¼šä¾æ¬¡æŸ¥æ‰¾ï¼š
// 1. .js æ–‡ä»¶
// 2. .json æ–‡ä»¶ï¼ˆä¼šè‡ªåŠ¨ JSON.parseï¼‰
// 3. .node æ–‡ä»¶ï¼ˆC++ æ’ä»¶ï¼‰
// 4. ç›®å½•ä¸­çš„ index.js
// 5. package.json ä¸­ main å­—æ®µæŒ‡å®šçš„æ–‡ä»¶
```

### 4. æ¨¡å—ç¼“å­˜

```javascript
// æ¨¡å—åœ¨é¦–æ¬¡ require åä¼šè¢«ç¼“å­˜
// å¤šæ¬¡ require åŒä¸€æ¨¡å—ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡
const mod1 = require('./myModule');
const mod2 = require('./myModule');
console.log(mod1 === mod2); // true

// æ¸…é™¤æ¨¡å—ç¼“å­˜
delete require.cache[require.resolve('./myModule')];
```

### 5. __dirname å’Œ __filename

```javascript
// CommonJS ä¸­å¯ç”¨
console.log(__dirname); // å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„
console.log(__filename); // å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„

// ESM ä¸­éœ€è¦ä½¿ç”¨ url æ¨¡å—
import { fileURLToPath } from 'node:url';
import { dirname, join } from 'node:path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
```

### 6. package.json ä¸­çš„æ¨¡å—é…ç½®

```json
{
  "name": "my-package",
  "version": "1.0.0",
  "type": "module",        // ä½¿ç”¨ ESM
  "main": "index.js",      // CommonJS å…¥å£
  "exports": {             // ç°ä»£æ¨¡å—å¯¼å‡ºé…ç½®
    ".": "./index.js",
    "./utils": "./utils.js"
  },
  "dependencies": {
    "express": "^4.18.0"
  }
}
```

## ğŸ¯ å­¦ä¹ è¿›åº¦
- [ ] æ¦‚å¿µç†è§£
- [ ] Demo å®Œæˆ
- [ ] å»¶ä¼¸é˜…è¯»

## ğŸ’¡ æ”¶è·ä¸æ„Ÿæ‚Ÿ
ï¼ˆå­¦ä¹ åå¡«å†™ï¼‰

## ğŸ¤” ç–‘é—®ä¸å¾…è§£å†³
ï¼ˆå­¦ä¹ åå¡«å†™ï¼‰

## ğŸ“š å»¶ä¼¸é˜…è¯»
- [Node.js Modules å®˜æ–¹æ–‡æ¡£](https://nodejs.org/api/modules.html)
- [ECMAScript Modules in Node.js](https://nodejs.org/api/esm.html)
- [CommonJS vs ES Modules](https://nodejs.org/api/esm.html#differences-between-es-modules-and-commonjs)

---

## ğŸ“ ä»Šæ—¥æµ‹éªŒï¼ˆ22:00 è¿½åŠ ï¼‰

### é—®é¢˜ 1ï¼šæ¨¡å—å¯¼å‡º
ä»¥ä¸‹ä»£ç ä¸­ï¼Œ`exports` å’Œ `module.exports` çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

```javascript
// file1.js
exports.name = 'MyModule';
exports.version = '1.0.0';

// file2.js
module.exports = {
  name: 'MyModule',
  version: '1.0.0'
};

// file3.js
exports = {
  name: 'MyModule',
  version: '1.0.0'
};
```

### é—®é¢˜ 2ï¼šæ¨¡å—ç¼“å­˜
æ‰§è¡Œä»¥ä¸‹ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

```javascript
// counter.js
let count = 0;
module.exports = {
  increment() { count++; },
  getCount() { return count; }
};

// main.js
const counter1 = require('./counter');
const counter2 = require('./counter');

counter1.increment();
counter2.increment();

console.log(counter1.getCount()); // è¾“å‡ºï¼Ÿ
console.log(counter2.getCount()); // è¾“å‡ºï¼Ÿ
console.log(counter1 === counter2); // è¾“å‡ºï¼Ÿ
```

### é—®é¢˜ 3ï¼šæ¨¡å—æŸ¥æ‰¾é¡ºåº
å½“ä½ æ‰§è¡Œ `require('./utils')` æ—¶ï¼ŒNode.js ä¼šæŒ‰ä»€ä¹ˆé¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼Ÿè¯·åˆ—å‡ºè‡³å°‘ 3 ç§å¯èƒ½çš„æŸ¥æ‰¾è·¯å¾„ã€‚

---

**è¯·åœ¨ä¸‹æ–¹è®°å½•ä½ çš„ç­”æ¡ˆï¼š**
